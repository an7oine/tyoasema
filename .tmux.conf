# Ohjeet:
# - Mikrobitti 9/2020
# - https://medium.com/@yash.kulshrestha/using-zsh-tmux-and-vim-for-web-development-eff7bd60e5d6
# - https://blog.petrzemek.net/2016/02/11/my-tmux-configuration/

# Päätteen tyyppi.
set -g default-terminal "screen-256color"

# Käytetään Ctrl–B:n sijaan Ctrl–välilyöntiä esinäppäimenä.
# MB: Ctrl–A
unbind C-b
set -g prefix C-Space
bind-key C-Space send-prefix

# Ladataan asetukset uudelleen esinäppäin+R -yhdistelmällä.
bind-key r source-file ~/.tmux.conf\; display-message "Tmux.conf ladattu."

# Jaa paneelit; yhdysmerkki: pystysuunnassa; alaviiva: vaakasuunnassa.
unbind %
unbind '"'
bind - split-window -v
bind | split-window -h

# Siirry ikkunoiden välillä välilyönnillä / askelpalauttimella.
bind space next-window
bind bspace previous-window
bind enter next-layout

# Siirry paneeleiden välillä: Control–HJKL.
# MB: Meta–nuolet
# bind -n C-H select-pane -L
# bind -n C-L select-pane -R
# bind -n C-K select-pane -U
# bind -n C-J select-pane -D

# Siirrytään Vim-ikkunoiden ja Tmux-paneelien välillä
# Ctrl-välilyönti + HJKL-näppäimillä.
# Ks. https://www.codeography.com/2013/06/19/navigating-vim-and-tmux-splits
bind h run \
  "(tmux display-message -p '#{pane_title}' | grep -q '\\(- VIM$\\|^vim$\\)' && tmux send-keys C-w h) || (tmux select-pane -L || true)"
bind j run \
  "(tmux display-message -p '#{pane_title}' | grep -q '\\(- VIM$\\|^vim$\\)' && tmux send-keys C-w j) || (tmux select-pane -D || true)"
bind k run \
  "(tmux display-message -p '#{pane_title}' | grep -q '\\(- VIM$\\|^vim$\\)' && tmux send-keys C-w k) || (tmux select-pane -U || true)"
bind l run \
  "(tmux display-message -p '#{pane_title}' | grep -q '\\(- VIM$\\|^vim$\\)' && tmux send-keys C-w l) || (tmux select-pane -R || true)"


# Komento Ctrl-HJKL: irrota nykyisen
# vasemmalla / ala- / ylä- / oikealla puolella
# oleva paneeli omaan ikkunaansa; älä aktivoi sitä.
bind C-h select-pane -L \; break-pane -d
bind C-j select-pane -D \; break-pane -d
bind C-k select-pane -U \; break-pane -d
bind C-l select-pane -R \; break-pane -d

# Komento Optio-HJKL: liitä viimeisin ikkuna paneeliksi nykyisen
# vasemmalle / ala- / ylä- / oikealle puolelle, ölä aktivoi sitä.
bind ˛ join-pane -b -d -h -s :-.-
bind √ join-pane -d -s :-.-
bind ª join-pane -b -d -s :-.-
bind ﬁ join-pane -d -h -s :-.-


# Vaihda paneelien paikkaa keskenään: esinäppäin+Ctrl–O
bind C-O rotate-window

# Muuta paneeleiden kokoa: Shift–HJKL.
# MB: Shift–nuolet
# bind -n S-H resize-pane -L 5
# bind -n S-L resize-pane -R 5
# bind -n S-K resize-pane -U 5
# bind -n S-J resize-pane -D 5

# Siirry kopiointitilaan: esinäppäin + V.
bind v copy-mode

# Rullaa hiirellä.
set -g mouse on
setw -g mouse on

# Aseta Vi-tyyliset näppäimet.
set -g status-keys vi
setw -g mode-keys vi

# Aloita ikkunoiden ja paneelien numerointi ykkösestä.
set -g base-index 1
setw -g pane-base-index 1

# Päivitä ikkunaotsikot.
set -g set-titles on
set -g renumber-windows on

# Kellotyyli.
setw -g clock-mode-style 24

# Aktiivisuuden tarkkailu.
setw -g monitor-activity on
setw -g monitor-bell off

# Kopioi sana kaksoisnapsautuksella; rivi Vaihto + kaksoisnapsautuksella.
bind -n DoubleClick1Pane \
    select-pane \; \
    copy-mode -M \; \
    send-keys -X select-word \; \
    run-shell "sleep .5s" \; \
    send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi DoubleClick1Pane \
    send-keys -X select-word \; \
    run-shell "sleep .5s" \; \
    send-keys -X copy-pipe "pbcopy"

bind -n S-DoubleClick1Pane \
    select-pane \; \
    copy-mode -M \; \
    send-keys -X select-line \; \
    run-shell "sleep .5s" \; \
    send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi S-DoubleClick1Pane \
    send-keys -X select-line \; \
    run-shell "sleep .5s" \; \
    send-keys -X copy-pipe "pbcopy"

# Ohita kaikki Tmux-komennot F12-näppäimellä (ohjaa sisempää tmux-istuntoa).
bind -T root F12  \
    set prefix None \;\
    set key-table off \;\
    if -F '#{pane_in_mode}' 'send-keys -X cancel' \;\
    refresh-client -S \;\

# Toinen F12-näppäimen painallus palauttaa komennot käyttöön.
bind -T off F12 \
  set -u prefix \;\
  set -u key-table \;\
  refresh-client -S


# Dracula-teeman lisätietokenttien asetukset.
set -g @dracula-show-fahrenheit false
set -g @dracula-military-time true
set -g @dracula-show-timezone false
set -g @dracula-cpu-usage true
set -g @dracula-day-month true

# Laajennostyökalu.
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# Kopiointi järjestelmän leikepöydälle.
set -g @plugin 'tmux-plugins/tmux-yank'

# Jatkuva tmux-ikkunoinnin tilan tallennus.
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Kopiointi ja haku säännöllisellä lausekkeella.
set -g @plugin 'tmux-plugins/tmux-copycat'

# Linkkien avaaminen konentorivin ulkopuolella.
set -g @plugin 'tmux-plugins/tmux-open'

# Tilarivi.
set -g @plugin 'tmux-plugins/tmux-cpu'

# Dracula-teema.
set -g @plugin 'dracula/tmux'

# Käynnistä Tpm.
run -b '~/.tmux/plugins/tpm/tpm'
